<template>
  <!-- <div id="chart" style="position: absolute; 
    top: 50%; 
    left: 50%;
    width: 100%;
    height: 100%;
    transform: translate(-50%, -50%) rotate(90deg);"></div> -->

  <div ref="container" class="overview-container">
    <div class="title">Discussion Review</div>
    <div ref="tuli" class="tuli-container"></div>
    <div id="chart" style="width: 100%; height: 135%"></div>
  </div>
</template>


<script>
import * as echarts from "echarts";
import * as d3 from "d3";

export default {
  name: "MyChart",
  props: {},

  mounted() {
    this.initChart();
    this.drawLegend(); // 新增图例绘制
  },

  methods: {
    initChart() {
      console.log(this.$refs.container.clientHeight);
      // 基于准备好的dom，初始化echarts实例
      const chart = echarts.init(document.getElementById("chart"));
      let option = {
        // height: "100%",
        tooltip: {
          show: false,
          trigger: "axis",
          axisPointer: {
            type: "line",
            lineStyle: {
              color: "rgba(0,0,0,0.2)",
              width: 1,
              type: "solid",
            },
          },
        },
        // legend: {
        //   data: ['QU', 'TY', 'AG', 'SU', 'SY', 'DD']
        // },
        singleAxis: {
          // top: 50,
          //   bottom: 50,
          // axisTick: {},
          // axisLabel: {},
          type: "time",
          axisLine: { show: false }, // 隐藏轴线
          axisTick: { show: false }, // 隐藏刻度
          axisLabel: { show: false }, // 隐藏标签
          splitLine: { show: false }, // 隐藏分隔线
          // axisPointer: {
          //   animation: true,
          //   label: {
          //     show: false
          //   }
          // },
          // splitLine: {
          //   show: true,
          //   lineStyle: {
          //     type: 'dashed',
          //     opacity: 0.2
          //   }
          // }
        },
        series: [
          {
            type: "themeRiver",
            emphasis: {
              itemStyle: {
                shadowBlur: 20,
                shadowColor: "rgba(0, 0, 0, 0.8)",
              },
            },
            // data: [
            //     ['2015/11/08', 10, 'QU'],
            //     ['2015/11/09', 15, 'QU'],
            //     ['2015/11/10', 35, 'QU'],
            //     ['2015/11/11', 38, 'QU'],
            //     ['2015/11/12', 22, 'QU'],
            //     ['2015/11/13', 16, 'QU'],
            //     ['2015/11/14', 7, 'QU'],
            //     ['2015/11/15', 2, 'QU'],
            //     ['2015/11/16', 17, 'QU'],
            //     ['2015/11/17', 33, 'QU'],
            //     ['2015/11/18', 40, 'QU'],
            //     ['2015/11/19', 32, 'QU'],
            //     ['2015/11/20', 26, 'QU'],
            //     ['2015/11/21', 35, 'QU'],
            //     ['2015/11/22', 40, 'QU'],
            //     ['2015/11/23', 32, 'QU'],
            //     ['2015/11/24', 26, 'QU'],
            //     ['2015/11/25', 22, 'QU'],
            //     ['2015/11/26', 16, 'QU'],
            //     ['2015/11/27', 22, 'QU'],
            //     ['2015/11/28', 10, 'QU'],
            //     ['2015/11/08', 35, 'TY'],
            //     ['2015/11/09', 36, 'TY'],
            //     ['2015/11/10', 37, 'TY'],
            //     ['2015/11/11', 22, 'TY'],
            //     ['2015/11/12', 24, 'TY'],
            //     ['2015/11/13', 26, 'TY'],
            //     ['2015/11/14', 34, 'TY'],
            //     ['2015/11/15', 21, 'TY'],
            //     ['2015/11/16', 18, 'TY'],
            //     ['2015/11/17', 45, 'TY'],
            //     ['2015/11/18', 32, 'TY'],
            //     ['2015/11/19', 35, 'TY'],
            //     ['2015/11/20', 30, 'TY'],
            //     ['2015/11/21', 28, 'TY'],
            //     ['2015/11/22', 27, 'TY'],
            //     ['2015/11/23', 26, 'TY'],
            //     ['2015/11/24', 15, 'TY'],
            //     ['2015/11/25', 30, 'TY'],
            //     ['2015/11/26', 35, 'TY'],
            //     ['2015/11/27', 42, 'TY'],
            //     ['2015/11/28', 42, 'TY'],
            //     ['2015/11/08', 21, 'AG'],
            //     ['2015/11/09', 25, 'AG'],
            //     ['2015/11/10', 27, 'AG'],
            //     ['2015/11/11', 23, 'AG'],
            //     ['2015/11/12', 24, 'AG'],
            //     ['2015/11/13', 21, 'AG'],
            //     ['2015/11/14', 35, 'AG'],
            //     ['2015/11/15', 39, 'AG'],
            //     ['2015/11/16', 40, 'AG'],
            //     ['2015/11/17', 36, 'AG'],
            //     ['2015/11/18', 33, 'AG'],
            //     ['2015/11/19', 43, 'AG'],
            //     ['2015/11/20', 40, 'AG'],
            //     ['2015/11/21', 34, 'AG'],
            //     ['2015/11/22', 28, 'AG'],
            //     ['2015/11/23', 26, 'AG'],
            //     ['2015/11/24', 37, 'AG'],
            //     ['2015/11/25', 41, 'AG'],
            //     ['2015/11/26', 46, 'AG'],
            //     ['2015/11/27', 47, 'AG'],
            //     ['2015/11/28', 41, 'AG'],
            //     ['2015/11/08', 10, 'SU'],
            //     ['2015/11/09', 15, 'SU'],
            //     ['2015/11/10', 35, 'SU'],
            //     ['2015/11/11', 38, 'SU'],
            //     ['2015/11/12', 22, 'SU'],
            //     ['2015/11/13', 16, 'SU'],
            //     ['2015/11/14', 7, 'SU'],
            //     ['2015/11/15', 2, 'SU'],
            //     ['2015/11/16', 17, 'SU'],
            //     ['2015/11/17', 33, 'SU'],
            //     ['2015/11/18', 40, 'SU'],
            //     ['2015/11/19', 32, 'SU'],
            //     ['2015/11/20', 26, 'SU'],
            //     ['2015/11/21', 35, 'SU'],
            //     ['2015/11/22', 40, 'SU'],
            //     ['2015/11/23', 32, 'SU'],
            //     ['2015/11/24', 26, 'SU'],
            //     ['2015/11/25', 22, 'SU'],
            //     ['2015/11/26', 16, 'SU'],
            //     ['2015/11/27', 22, 'SU'],
            //     ['2015/11/28', 10, 'SU'],
            // ],

            // 案例2

            data: [
              // QU系列（绿色增长曲线）
              ["2015/11/08", 10, "QU"],
              ["2015/11/09", 15, "QU"],
              ["2015/11/10", 35, "QU"],
              ["2015/11/11", 38, "QU"],
              ["2015/11/12", 22, "QU"],
              ["2015/11/13", 16, "QU"],
              ["2015/11/14", 7, "QU"],
              // 开始增长但保留波动
              ["2015/11/15", 28, "QU"],
              ["2015/11/16", 25, "QU"], // 回调波动
              ["2015/11/17", 42, "QU"],
              ["2015/11/18", 50, "QU"],
              ["2015/11/19", 35, "QU"], // 中途回调
              ["2015/11/20", 60, "QU"],
              ["2015/11/21", 75, "QU"],
              ["2015/11/22", 68, "QU"], // 技术性调整
              ["2015/11/23", 35, "QU"],
              ["2015/11/24", 42, "QU"],
              ["2015/11/25", 28, "QU"], // 获利回吐
              ["2015/11/26", 10, "QU"],
              ["2015/11/27", 15, "QU"],
              ["2015/11/28", 11, "QU"],

              // TY系列（灰色衰退曲线）
              ["2015/11/08", 35, "TY"],
              ["2015/11/09", 36, "TY"],
              ["2015/11/10", 37, "TY"],
              ["2015/11/11", 22, "TY"],
              ["2015/11/12", 34, "TY"],
              ["2015/11/13", 26, "TY"],
              ["2015/11/14", 34, "TY"],
              ["2015/11/15", 25, "TY"],
              ["2015/11/16", 18, "TY"],
              ["2015/11/17", 13, "TY"],
              ["2015/11/18", 10, "TY"],
              ["2015/11/19", 10, "TY"],
              ["2015/11/20", 23, "TY"],
              ["2015/11/21", 12, "TY"],
              ["2015/11/22", 40, "TY"],
              ["2015/11/23", 20, "TY"],
              ["2015/11/24", 70, "TY"],
              ["2015/11/25", 60, "TY"],
              ["2015/11/26", 50, "TY"],
              ["2015/11/27", 50, "TY"],
              ["2015/11/28", 60, "TY"],

              // AG系列（蓝色爆发曲线）
              ["2015/11/08", 21, "AG"],
              ["2015/11/09", 25, "AG"],
              ["2015/11/10", 30, "AG"],
              ["2015/11/11", 23, "AG"],
              ["2015/11/12", 14, "AG"],
              ["2015/11/13", 31, "AG"],
              ["2015/11/14", 35, "AG"],
              // 阶梯式增长+波动
              ["2015/11/15", 40, "AG"],
              ["2015/11/16", 38, "AG"], // 技术回调
              ["2015/11/17", 20, "AG"],
              ["2015/11/18", 55, "AG"],
              ["2015/11/19", 52, "AG"], // 正常波动
              ["2015/11/20", 25, "AG"],
              ["2015/11/21", 70, "AG"],
              ["2015/11/22", 67, "AG"], // 短期盘整
              ["2015/11/23", 45, "AG"],
              ["2015/11/24", 22, "AG"],
              ["2015/11/25", 28, "AG"], // 市场消化
              ["2015/11/26", 30, "AG"],
              ["2015/11/27", 45, "AG"],
              ["2015/11/28", 22, "AG"], // 尾盘调整

              // SU系列（橙色消亡曲线）
              ["2015/11/08", 10, "SU"],
              ["2015/11/09", 15, "SU"],
              ["2015/11/10", 35, "SU"],
              ["2015/11/11", 38, "SU"],
              ["2015/11/12", 22, "SU"],
              ["2015/11/13", 16, "SU"],
              ["2015/11/14", 7, "SU"],
              ["2015/11/15", 0, "SU"],
              ["2015/11/16", 0, "SU"],
              ["2015/11/17", 0, "SU"],
              ["2015/11/18", 10, "SU"],
              ["2015/11/19", 6, "SU"],
              ["2015/11/20", 5, "SU"],
              ["2015/11/21", 0, "SU"],
              ["2015/11/22", 50, "SU"],
              ["2015/11/23", 50, "SU"],
              ["2015/11/24", 50, "SU"],
              ["2015/11/25", 50, "SU"],
              ["2015/11/26", 50, "SU"],
              ["2015/11/27", 50, "SU"],
              ["2015/11/28", 50, "SU"],
            ],

            // //案例1
            // data: [
            //   // QU系列（绿色增长曲线）中间阶段波动增强
            //   ["2015/11/08", 12, "QU"],
            //   ["2015/11/09", 14, "QU"],
            //   ["2015/11/10", 16, "QU"],
            //   ["2015/11/11", 18, "QU"],
            //   ["2015/11/12", 20, "QU"],
            //   ["2015/11/13", 22, "QU"], // 前期平稳增长
            //   ["2015/11/14", 24, "QU"],
            //   // 中期争议阶段（高交互量）
            //   ["2015/11/15", 85, "QU"],
            //   ["2015/11/16", 92, "QU"], // 争议峰值
            //   ["2015/11/17", 78, "QU"],
            //   ["2015/11/18", 95, "QU"], // 反对声浪
            //   ["2015/11/19", 88, "QU"], // 持续高交互
            //   ["2015/11/20", 82, "QU"],
            //   ["2015/11/21", 75, "QU"], // 逐步回落
            //   ["2015/11/22", 68, "QU"], // 技术性调整
            //   // 后期恢复常态
            //   ["2015/11/23", 38, "QU"],
            //   ["2015/11/24", 42, "QU"],
            //   ["2015/11/25", 30, "QU"],
            //   ["2015/11/26", 28, "QU"],
            //   ["2015/11/27", 25, "QU"],
            //   ["2015/11/28", 22, "QU"],

            //   // TY系列（灰色衰退曲线）中期质疑集中
            //   ["2015/11/08", 40, "TY"],
            //   ["2015/11/09", 38, "TY"],
            //   ["2015/11/10", 36, "TY"],
            //   ["2015/11/11", 34, "TY"],
            //   ["2015/11/12", 32, "TY"],
            //   ["2015/11/13", 30, "TY"], // 稳定衰退
            //   // 中期质疑爆发
            //   ["2015/11/14", 65, "TY"],
            //   ["2015/11/15", 78, "TY"], // 质疑高峰
            //   ["2015/11/16", 82, "TY"],
            //   ["2015/11/17", 75, "TY"], // 争议集中
            //   ["2015/11/18", 68, "TY"],
            //   ["2015/11/19", 60, "TY"], // 余波持续
            //   ["2015/11/20", 55, "TY"],
            //   ["2015/11/21", 50, "TY"], // 回归衰退
            //   ["2015/11/22", 45, "TY"],
            //   // 后期加速消亡
            //   ["2015/11/23", 30, "TY"],
            //   ["2015/11/24", 25, "TY"],
            //   ["2015/11/25", 20, "TY"],
            //   ["2015/11/26", 18, "TY"],
            //   ["2015/11/27", 15, "TY"],
            //   ["2015/11/28", 12, "TY"],

            //   // AG系列（蓝色爆发曲线）中期激烈辩论
            //   ["2015/11/08", 20, "AG"],
            //   ["2015/11/09", 22, "AG"],
            //   ["2015/11/10", 25, "AG"],
            //   ["2015/11/11", 28, "AG"], // 前期预热
            //   ["2015/11/12", 30, "AG"],
            //   ["2015/11/13", 35, "AG"],
            //   ["2015/11/14", 40, "AG"],
            //   // 爆发期争议（交互倍增）
            //   ["2015/11/15", 120, "AG"],
            //   ["2015/11/16", 135, "AG"], // 论战高峰
            //   ["2015/11/17", 110, "AG"],
            //   ["2015/11/18", 140, "AG"], // 多空博弈
            //   ["2015/11/19", 130, "AG"], // 持续高热
            //   ["2015/11/20", 115, "AG"],
            //   ["2015/11/21", 105, "AG"], // 逐步冷却
            //   ["2015/11/22", 95, "AG"],
            //   // 后期正常波动
            //   ["2015/11/23", 50, "AG"],
            //   ["2015/11/24", 45, "AG"],
            //   ["2015/11/25", 42, "AG"],
            //   ["2015/11/26", 38, "AG"],
            //   ["2015/11/27", 35, "AG"],
            //   ["2015/11/28", 30, "AG"],

            //   // SU系列（橙色消亡曲线）中期短暂复活
            //   ["2015/11/08", 35, "SU"],
            //   ["2015/11/09", 30, "SU"],
            //   ["2015/11/10", 25, "SU"],
            //   ["2015/11/11", 20, "SU"], // 消亡初期
            //   ["2015/11/12", 18, "SU"],
            //   ["2015/11/13", 15, "SU"],
            //   ["2015/11/14", 12, "SU"],
            //   // 中期争议反弹
            //   ["2015/11/15", 85, "SU"],
            //   ["2015/11/16", 75, "SU"], // 质疑回潮
            //   ["2015/11/17", 90, "SU"],
            //   ["2015/11/18", 95, "SU"], // 最后争论
            //   ["2015/11/19", 82, "SU"],
            //   ["2015/11/20", 70, "SU"], // 争议尾声
            //   ["2015/11/21", 60, "SU"],
            //   ["2015/11/22", 50, "SU"],
            //   // 最终消亡
            //   ["2015/11/23", 30, "SU"],
            //   ["2015/11/24", 25, "SU"],
            //   ["2015/11/25", 20, "SU"],
            //   ["2015/11/26", 15, "SU"],
            //   ["2015/11/27", 10, "SU"],
            //   ["2015/11/28", 5, "SU"],
            // ],

            itemStyle: {
              color: function (params) {
                const category = params.data[2];
                switch (category) {
                  case "QU":
                    return " #FFB6C1";
                  case "TY":
                    return "#FFD700";
                  case "AG":
                    return " #7FFFD4";
                  case "SU":
                    return "#6495ED";
                  default:
                    return "#CCCCCC"; // 默认颜色
                }
              },
            },
          },
        ],
      };
      // 使用刚指定的配置项和数据显示图表
      chart.setOption(option);
    },
    drawLegend() {
      // 图例数据
      const legendData = [
        { name: "QU", color: "#FFB6C1" }, // 粉红
        { name: "TY", color: "#FFD700" }, // 金色
        { name: "AG", color: "#7FFFD4" }, // 碧绿
        { name: "SU", color: "#6495ED" }, // 蓝灰
      ];

      // 获取容器
      const container = d3.select(this.$refs.tuli).style("padding", "10px 0");

      // 创建SVG
      const svg = container
        .append("svg")
        .attr("width", "100%")
        .attr("height", 40);

      // 创建图例组
      const legend = svg
        .selectAll(".legend")
        .data(legendData)
        .enter()
        .append("g")
        .attr("class", "legend")
        .attr("transform", (d, i) => `translate(${i * 100}, 10)`);

      // 绘制颜色方块
      legend
        .append("rect")
        .attr("width", 18)
        .attr("height", 8)
        .style("fill", (d) => d.color)
        .style("rx", 4); // 圆角

      // 添加文字标签
      legend
        .append("text")
        .attr("x", 24)
        .attr("y", 4)
        .attr("dy", ".35em")
        .style("font", "12px sans-serif")
        .style("fill", "#333")
        .text((d) => d.name);
    },
  },
};
</script>
<style scoped>
.overview-container {
  width: 100%;
  height: 90%;
  position: relative;
  display: flex;
  flex-direction: column;
  border-radius: 8px;
  /* background-color: gray; */
  /* 灰色边框 */
  border: 1px solid #ddd;
  /* 阴影效果 */
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08),
    /* 底层阴影 */ 0 6px 16px rgba(0, 0, 0, 0.06);
  /* 上层阴影 */
  /* 保证阴影在圆角处正常显示 */
  overflow: hidden;
}

.title {
  color: #4cc4d5;
  font-size: 20px;
  font-weight: bold;
  text-align: left;
  /* background-color: beige; */
}
.tuli-container {
  width: 100%;
  height: 0vh;
}
</style>